<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDKeys-Steam ê°€ê²©ë¹„êµì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f0f2f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .server-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }
        
        .tab-container {
            margin-bottom: 30px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 0;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab-button {
            padding: 15px 30px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            margin-bottom: -2px;
        }
        
        .tab-button:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 0 10px 10px 10px;
            border: 2px solid #e0e0e0;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .url-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .url-input-row .remove-btn {
            padding: 8px 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            min-width: auto;
        }
        
        .url-input-row .remove-btn:hover {
            background: #c82333;
        }
        
        input[type="text"], input[type="number"] {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        input[type="number"] {
            max-width: 150px;
        }
        
        button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745, #218838);
        }
        
        .btn-management {
            background: linear-gradient(135deg, #17a2b8, #138496) !important;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800) !important;
            color: #212529 !important;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #6f42c1, #563d7c) !important;
        }
        
        .progress-section {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }
        
        .progress-section.active {
            display: block;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .export-section {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }
        
        .export-section.show {
            display: block;
        }
        
        .export-section h3 {
            color: #28a745;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .selection-info {
            background: #fff;
            border: 1px solid #28a745;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .export-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .results {
            display: grid;
            gap: 20px;
        }
        
        .game-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            border-left: 5px solid #4caf50;
            position: relative;
        }
        
        .game-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }
        
        .game-card.selected {
            border-left-color: #28a745;
            background: #f8fff9;
        }
        
        .game-card.not-found {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        
        .game-checkbox {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-right: 40px;
        }
        
        .game-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }
        
        .savings-badge {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .not-found-badge {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .steam-source-badge {
            background: linear-gradient(135deg, #6f42c1, #563d7c);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        .price-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: center;
        }
        
        .price-box {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .cdkeys-price {
            background: #e8f5e9;
            border: 2px solid #4caf50;
        }
        
        .steam-price {
            background: #f3e5f5;
            border: 2px solid #9c27b0;
        }
        
        .price-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .price-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        
        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .discount-badge {
            background: #ff5722;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 5px;
        }
        
        .sell-price-input {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        
        .sell-price-input.show {
            display: block;
        }
        
        .sell-price-input label {
            font-weight: bold;
            color: #856404;
            margin-bottom: 5px;
            display: block;
        }
        
        .sell-price-input input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        /* í•œê¸€ëª… ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .korean-name-input {
            background: #f0f8ff;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        
        .korean-name-input.show {
            display: block;
        }
        
        .korean-name-input label {
            font-weight: bold;
            color: #0056b3;
            margin-bottom: 5px;
            display: block;
        }
        
        .korean-name-input input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .app-id-input {
            background: #e1ecf4;
            border: 2px solid #0056b3;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .app-id-input label {
            font-weight: bold;
            color: #0056b3;
            margin-bottom: 5px;
            display: block;
        }
        
        .app-id-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .app-id-controls input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .app-id-controls button {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-link {
            flex: 1;
            padding: 10px;
            text-align: center;
            text-decoration: none;
            color: white;
            border-radius: 5px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        .btn-link:hover {
            transform: translateY(-2px);
        }
        
        .btn-cdkeys {
            background: #4caf50;
        }
        
        .error-message {
            background: #fee;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            color: #c0392b;
        }
        
        .not-found-section {
            background: #fff5f5;
            border: 2px solid #dc3545;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }
        
        .not-found-section.show {
            display: block;
        }
        
        .not-found-section h3 {
            color: #dc3545;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .not-found-info {
            background: #fff;
            border: 1px solid #dc3545;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .example-urls {
            margin-top: 10px;
            padding: 10px;
            background: #fff;
            border-radius: 5px;
            font-size: 14px;
            color: #666;
        }
        
        .example-urls strong {
            color: #333;
        }

        .steam-api-indicator {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            border-radius: 5px;
            padding: 8px 12px;
            font-size: 12px;
            color: #2e7d32;
            font-weight: bold;
        }
        
        .steamdb-indicator {
            background: #f3e5f5;
            border: 1px solid #9c27b0;
            border-radius: 5px;
            padding: 8px 12px;
            font-size: 12px;
            color: #6a1b9a;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® CDKeys/Loaded-Steam ê°€ê²©ë¹„êµ</h1>
        
        <div class="status-bar">
            <div class="server-status">
                <span class="status-indicator"></span>
                <span id="serverStatus">ì„œë²„ í™•ì¸ì¤‘...</span>
                <span class="steam-api-indicator">Steam API + SteamDB</span>
            </div>
            <div>
                <button onclick="clearCache()" class="btn-secondary">ìºì‹œ ì´ˆê¸°í™”</button>
            </div>
        </div>
        
        <!-- íƒ­ ê¸°ë°˜ UI -->
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('single')">
                    ğŸ” ë‹¨ì¼ URL ê²€ìƒ‰
                </button>
                <button class="tab-button" onclick="switchTab('multi')">
                    ğŸ¯ ì—¬ëŸ¬ URL ë™ì‹œ ê²€ìƒ‰
                </button>
            </div>
            
            <!-- íƒ­ 1: ë‹¨ì¼ URL ê²€ìƒ‰ -->
            <div id="singleTab" class="tab-content active">
                <div class="input-section">
                    <div class="input-group">
                        <input type="text" 
                               id="cdkeysUrl" 
                               placeholder="CDKeys ë˜ëŠ” Loaded URL ì…ë ¥"
                               style="flex: 3;"
                               value="">
                        <input type="number" 
                               id="minDifference" 
                               placeholder="ë§ˆì§„ìœ¨(%)"
                               value="0"
                               min="0"
                               max="100"
                               style="flex: 0 0 120px;">
                        <label style="display: flex; align-items: center; gap: 8px; white-space: nowrap; flex: 0 0 auto;">
                            <input type="checkbox" id="isSinglePage" style="width: 20px; height: 20px; cursor: pointer;">
                            <span style="font-weight: 600;">ë‹¨ì¼ í˜ì´ì§€</span>
                        </label>
                    </div>
                    <div class="input-group">
                        <button id="compareBtn" onclick="startComparison()" style="width: 100%;">ğŸš€ ê°€ê²© ë¹„êµ ì‹œì‘</button>
                    </div>
                    <div class="example-urls">
                        <strong style="color: #667eea;">ğŸ’¡ ì‚¬ìš© ë°©ë²•:</strong><br>
                        <div style="margin-top: 10px; line-height: 1.8;">
                            <strong>ğŸ“‹ ëª©ë¡ í˜ì´ì§€:</strong> ì²´í¬ë°•ìŠ¤ <strong>í•´ì œ</strong> â†’ ì—¬ëŸ¬ ê²Œì„ ë¹„êµ<br>
                            <code style="background: #e0e0e0; padding: 2px 8px; border-radius: 4px; font-size: 13px;">https://www.cdkeys.com/pc/games</code><br>
                            <code style="background: #e0e0e0; padding: 2px 8px; border-radius: 4px; font-size: 13px;">https://www.loaded.com/pc/games</code><br>
                            <br>
                            <strong>ğŸ“„ ë‹¨ì¼ í˜ì´ì§€:</strong> ì²´í¬ë°•ìŠ¤ <strong>ì²´í¬</strong> â†’ ë‹¨ì¼ ê²Œì„ ë¹„êµ<br>
                            <code style="background: #e0e0e0; padding: 2px 8px; border-radius: 4px; font-size: 13px;">https://www.cdkeys.com/game-name-pc-steam</code><br>
                            <code style="background: #e0e0e0; padding: 2px 8px; border-radius: 4px; font-size: 13px;">https://www.loaded.com/game-name-pc-steam</code>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- íƒ­ 2: ì—¬ëŸ¬ URL ë™ì‹œ ê²€ìƒ‰ -->
            <div id="multiTab" class="tab-content">
                <div class="input-section">
                    <div id="urlInputsContainer">
                        <!-- URL ì…ë ¥ë€ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                    </div>
                    <div class="btn-group" style="margin-bottom: 15px;">
                        <button type="button" onclick="addUrlInput()" class="btn-info" style="background: linear-gradient(135deg, #17a2b8, #138496) !important; min-width: auto;">â• URL ì¶”ê°€</button>
                        <button type="button" onclick="removeUrlInput()" class="btn-warning" style="background: linear-gradient(135deg, #ffc107, #e0a800) !important; color: #212529 !important; min-width: auto;">â– URL ì‚­ì œ</button>
                        <button type="button" onclick="clearAllUrls()" class="btn-secondary" style="min-width: auto;">ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
                    </div>
                    <div class="input-group">
                        <input type="number" 
                               id="minDifferenceMulti" 
                               placeholder="ë§ˆì§„ìœ¨(%)"
                               value="0"
                               min="0"
                               max="100"
                               style="flex: 0 0 150px;">
                        <button id="compareMultiBtn" onclick="startMultiSingleComparison()" class="btn-success" style="flex: 1; background: linear-gradient(135deg, #28a745, #218838) !important;">ğŸš€ ì—¬ëŸ¬ ê²Œì„ ê°€ê²© ë¹„êµ ì‹œì‘</button>
                    </div>
                    <div class="example-urls">
                        <strong style="color: #667eea;">ğŸ’¡ ì‚¬ìš© ë°©ë²•:</strong><br>
                        <div style="margin-top: 10px; line-height: 1.8;">
                            1. <strong>â• URL ì¶”ê°€</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì…ë ¥ë€ ì¶”ê°€<br>
                            2. ê° ì…ë ¥ë€ì— <strong>CDKeys/Loaded ë‹¨ì¼ í˜ì´ì§€ URL</strong> ì…ë ¥<br>
                            3. ë§ˆì§„ìœ¨ì„ ì„¤ì •í•˜ê³  <strong>ğŸš€ ì—¬ëŸ¬ ê²Œì„ ê°€ê²© ë¹„êµ ì‹œì‘</strong> í´ë¦­<br>
                            <br>
                            <strong>ì˜ˆì‹œ:</strong><br>
                            <code style="background: #e0e0e0; padding: 2px 8px; border-radius: 4px; font-size: 13px;">https://www.cdkeys.com/game-name-pc-steam</code><br>
                            <code style="background: #e0e0e0; padding: 2px 8px; border-radius: 4px; font-size: 13px;">https://www.loaded.com/game-name-pc-steam</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="progressSection" class="progress-section">
            <div id="progressText">ì²˜ë¦¬ ì¤‘...</div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill">0%</div>
            </div>
        </div>
        
        <div id="statsSection" class="stats-section" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="totalGames">0</div>
                <div class="stat-label">ì „ì²´ ê²Œì„</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="discountedGames">0</div>
                <div class="stat-label">í• ì¸ ê²Œì„</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="notFoundGames">0</div>
                <div class="stat-label">ë¯¸ë°œê²¬ ê²Œì„</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgSavings">â‚©0</div>
                <div class="stat-label">í‰ê·  ì ˆì•½ì•¡</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="maxSavings">â‚©0</div>
                <div class="stat-label">ìµœëŒ€ ì ˆì•½ì•¡</div>
            </div>
        </div>
        
        <div id="exportSection" class="export-section">
            <h3>ğŸ“Š ì„ íƒëœ ê²Œì„ ì—‘ì…€ ë‚´ë³´ë‚´ê¸°</h3>
            <div class="selection-info" id="selectionInfo">
                ì„ íƒëœ ê²Œì„: 0ê°œ
            </div>
            <div class="export-controls">
                <button onclick="exportToExcel()" class="btn-success" style="font-size: 18px; padding: 15px 30px;">
                    ğŸ“ ì—‘ì…€ íŒŒì¼ ë‚´ë³´ë‚´ê¸°
                </button>
                <button onclick="exportToExcelManagement()" class="btn-management" style="font-size: 18px; padding: 15px 30px;">
                    ğŸ“Š ì—‘ì…€ íŒŒì¼ ë‚´ë³´ë‚´ê¸°_ê´€ë¦¬ìš©
                </button>
                <button onclick="selectAllGames()">âœ… ì „ì²´ ì„ íƒ</button>
                <button onclick="deselectAllGames()">âŒ ì „ì²´ í•´ì œ</button>
            </div>
        </div>
        
        <div id="notFoundSection" class="not-found-section">
            <h3>ğŸ” Steamì—ì„œ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²Œì„</h3>
            <div class="not-found-info" id="notFoundInfo">
                ë¯¸ë°œê²¬ ê²Œì„: 0ê°œ
            </div>
            <div id="notFoundResults"></div>
        </div>
        
        <div id="results" class="results"></div>
    </div>
    
    <script>
        const SERVER_URL = window.location.origin;
        let selectedGames = [];
        let allGames = [];
        let notFoundGames = [];
        
        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì½˜í…ì¸ ì˜ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            if (tabName === 'single') {
                document.querySelector('.tab-button:first-child').classList.add('active');
                document.getElementById('singleTab').classList.add('active');
            } else if (tabName === 'multi') {
                document.querySelector('.tab-button:last-child').classList.add('active');
                document.getElementById('multiTab').classList.add('active');
                // ë©€í‹° íƒ­ìœ¼ë¡œ ì „í™˜ ì‹œ URL ì…ë ¥ë€ ì´ˆê¸°í™”
                initializeMultiUrlInputs();
            }
        }
        
        // ë©€í‹° URL ì…ë ¥ë€ ì´ˆê¸°í™”
        function initializeMultiUrlInputs() {
            const container = document.getElementById('urlInputsContainer');
            if (container.children.length === 0) {
                addUrlInput();
            }
        }
        
        // URL ì…ë ¥ë€ ì¶”ê°€ (ê°œì„ ëœ UI)
        function addUrlInput() {
            const container = document.getElementById('urlInputsContainer');
            const count = container.querySelectorAll('.url-input-row').length + 1;
            
            const inputRow = document.createElement('div');
            inputRow.className = 'url-input-row';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'single-page-url';
            input.placeholder = `CDKeys ë‹¨ì¼ í˜ì´ì§€ URL #${count}`;
            input.style.flex = '1';
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = 'âœ•';
            removeBtn.onclick = function() {
                if (container.querySelectorAll('.url-input-row').length > 1) {
                    inputRow.remove();
                } else {
                    alert('ìµœì†Œ 1ê°œì˜ URL ì…ë ¥ë€ì€ ìœ ì§€ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.');
                }
            };
            
            inputRow.appendChild(input);
            inputRow.appendChild(removeBtn);
            container.appendChild(inputRow);
        }
        
        // URL ì…ë ¥ë€ ì‚­ì œ (ë§ˆì§€ë§‰ ê²ƒë§Œ)
        function removeUrlInput() {
            const container = document.getElementById('urlInputsContainer');
            const rows = container.querySelectorAll('.url-input-row');
            
            if (rows.length > 1) {
                container.removeChild(rows[rows.length - 1]);
            } else {
                alert('ìµœì†Œ 1ê°œì˜ URL ì…ë ¥ë€ì€ ìœ ì§€ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.');
            }
        }
        
        // ì „ì²´ URL ì´ˆê¸°í™”
        function clearAllUrls() {
            if (confirm('ëª¨ë“  ì…ë ¥ëœ URLì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const container = document.getElementById('urlInputsContainer');
                container.innerHTML = '';
                addUrlInput();
            }
        }
        
        async function checkServerStatus() {
            try {
                const response = await fetch(`${SERVER_URL}/api/status`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('serverStatus').textContent = 'ì„œë²„ ì—°ê²°ë¨ (Steam API + SteamDB)';
                    document.querySelector('.status-indicator').style.background = '#4caf50';
                } else {
                    throw new Error('Server not responding');
                }
            } catch (error) {
                document.getElementById('serverStatus').textContent = 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨';
                document.querySelector('.status-indicator').style.background = '#e74c3c';
            }
        }
        
        window.addEventListener('load', () => {
            checkServerStatus();
            setInterval(checkServerStatus, 30000);
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ë©€í‹° URL ì…ë ¥ë€ ì´ˆê¸°í™”
            initializeMultiUrlInputs();
        });
        
        // ê¸°ì¡´ ë‹¨ì¼ URL ê°€ê²© ë¹„êµ (ëª©ë¡ ë˜ëŠ” ë‹¨ì¼ í˜ì´ì§€)
        async function startComparison() {
            const url = document.getElementById('cdkeysUrl').value.trim();
            const margin = parseInt(document.getElementById('minDifference').value) || 0;
            const isSinglePage = document.getElementById('isSinglePage').checked;
            
            if (!url) {
                showError('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!url.includes('cdkeys.com') && !url.includes('loaded.com')) {
                showError('ì˜¬ë°”ë¥¸ CDKeys ë˜ëŠ” Loaded URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const button = document.getElementById('compareBtn');
            button.disabled = true;
            
            document.getElementById('results').innerHTML = '';
            document.getElementById('notFoundResults').innerHTML = '';
            document.getElementById('statsSection').style.display = 'none';
            document.getElementById('exportSection').classList.remove('show');
            document.getElementById('notFoundSection').classList.remove('show');
            selectedGames = [];
            allGames = [];
            notFoundGames = [];
            
            if (isSinglePage) {
                // ë‹¨ì¼ í˜ì´ì§€ ë¹„êµ
                showProgress('ë‹¨ì¼ í˜ì´ì§€ì—ì„œ ê°€ê²© ì •ë³´ë¥¼ ìˆ˜ì§‘ì¤‘ì…ë‹ˆë‹¤...', 10);
                
                try {
                    const response = await fetch(`${SERVER_URL}/api/compare-single`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ url, margin })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        allGames = [data.result];
                        displaySingleResult(data.result);
                        hideProgress();
                    } else {
                        showError(data.message || 'ê²Œì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        hideProgress();
                    }
                    
                } catch (error) {
                    showError(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                    hideProgress();
                } finally {
                    button.disabled = false;
                }
            } else {
                // ëª©ë¡ í˜ì´ì§€ ë¹„êµ (ê¸°ì¡´ ë¡œì§)
                showProgress('Steam API + SteamDBë¡œ ê°€ê²© ì •ë³´ë¥¼ ìˆ˜ì§‘ì¤‘ì…ë‹ˆë‹¤...', 10);
                
                try {
                    const response = await fetch(`${SERVER_URL}/api/compare`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ url, minDifference: margin })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        allGames = data.games || [];
                        notFoundGames = data.notFound || [];
                        displayResults(data);
                        displayNotFoundGames(data);
                        hideProgress();
                    } else {
                        throw new Error(data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                    }
                    
                } catch (error) {
                    showError(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                    hideProgress();
                } finally {
                    button.disabled = false;
                }
            }
        }
        

        
        // ì—¬ëŸ¬ ë‹¨ì¼ í˜ì´ì§€ ê°€ê²© ë¹„êµ
        async function startMultiSingleComparison() {
            const urlInputs = document.querySelectorAll('.single-page-url');
            const urls = Array.from(urlInputs)
                .map(input => input.value.trim())
                .filter(url => url.length > 0);
            
            const margin = parseInt(document.getElementById('minDifferenceMulti').value) || 0;
            
            if (urls.length === 0) {
                showError('ë‹¨ì¼ í˜ì´ì§€ URLì„ í•˜ë‚˜ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ëª¨ë“  URLì´ cdkeys.com ë˜ëŠ” loaded.comì„ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸
            const invalidUrls = urls.filter(url => !url.includes('cdkeys.com') && !url.includes('loaded.com'));
            if (invalidUrls.length > 0) {
                showError('ëª¨ë“  URLì€ cdkeys.com ë˜ëŠ” loaded.comì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            const button = document.getElementById('compareMultiBtn');
            button.disabled = true;
            
            document.getElementById('results').innerHTML = '';
            document.getElementById('notFoundResults').innerHTML = '';
            document.getElementById('statsSection').style.display = 'none';
            document.getElementById('exportSection').classList.remove('show');
            document.getElementById('notFoundSection').classList.remove('show');
            selectedGames = [];
            allGames = [];
            notFoundGames = [];
            
            showProgress(`${urls.length}ê°œì˜ ë‹¨ì¼ í˜ì´ì§€ì—ì„œ ê°€ê²© ì •ë³´ë¥¼ ìˆ˜ì§‘ì¤‘ì…ë‹ˆë‹¤...`, 10);
            
            try {
                const response = await fetch(`${SERVER_URL}/api/compare-multi-single`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ urls, margin })
                });
                
                if (!response.ok) {
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    allGames = data.results.filter(r => r.success).map(r => r.result);
                    notFoundGames = data.results.filter(r => !r.success).map(r => ({
                        id: r.id || 'unknown',
                        name: r.name || 'ì•Œ ìˆ˜ ì—†ìŒ',
                        price: 'ì•Œ ìˆ˜ ì—†ìŒ',
                        cdkeysUrl: r.url || '',
                        reason: r.message || 'Steamì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŒ'
                    }));
                    
                    // ê²°ê³¼ í‘œì‹œ
                    displayResults({
                        totalGames: allGames.length + notFoundGames.length,
                        discountedGames: allGames.filter(g => g.isProfit).length,
                        notFoundGames: notFoundGames.length,
                        games: allGames
                    });
                    
                    if (notFoundGames.length > 0) {
                        displayNotFoundGames({ notFound: notFoundGames });
                    }
                    
                    hideProgress();
                } else {
                    showError(data.message || 'ê²Œì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    hideProgress();
                }
                
            } catch (error) {
                showError(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                hideProgress();
            } finally {
                button.disabled = false;
            }
        }
        
        // App IDë¡œ Steam ì •ë³´ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
        async function refreshSteamInfo(gameId) {
            const appIdInput = document.querySelector(`input[data-game-id="${gameId}"]`);
            const appId = appIdInput.value.trim();
            
            if (!appId) {
                alert('App IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!/^\d+$/.test(appId)) {
                alert('App IDëŠ” ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            const button = appIdInput.nextElementSibling;
            button.disabled = true;
            button.textContent = 'ì¡°íšŒì¤‘...';
            
            try {
                const response = await fetch(`${SERVER_URL}/api/refresh-steam-info`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        gameId: gameId,
                        appId: appId,
                        allGames: allGames
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // ê²Œì„ ì •ë³´ ì—…ë°ì´íŠ¸
                    allGames[data.gameIndex] = data.game;
                    
                    // í™”ë©´ ìƒˆë¡œê³ ì¹¨
                    displayResults({
                        totalGames: allGames.length + notFoundGames.length,
                        discountedGames: allGames.length,
                        notFoundGames: notFoundGames.length,
                        games: allGames
                    });
                    
                    alert(`âœ… Steam ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nê²Œì„ëª…: ${data.game.exactName}\nì ˆì•½ì•¡: ${formatPrice(data.game.savings)}`);
                } else {
                    throw new Error(data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                }
                
            } catch (error) {
                alert(`âŒ Steam ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = 'ğŸ”„ ì¡°íšŒ';
            }
        }
        
        function toggleGameSelection(checkbox, gameIndex) {
            const game = allGames[gameIndex];
            const gameCard = checkbox.closest('.game-card');
            
            if (checkbox.checked) {
                gameCard.classList.add('selected');
                const sellPriceInput = gameCard.querySelector('.sell-price-input');
                const koreanNameInput = gameCard.querySelector('.korean-name-input');
                sellPriceInput.classList.add('show');
                koreanNameInput.classList.add('show');
                
                const defaultPrice = Math.round(game.cdkeysPrice * 1.1);
                const sellInput = sellPriceInput.querySelector('input');
                sellInput.value = defaultPrice;
                
                // í•œê¸€ëª… ê¸°ë³¸ê°’ ì„¤ì • (Steam APIì—ì„œ ê°€ì ¸ì˜¨ í•œê¸€ëª…ì´ ìˆë‹¤ë©´ ì„¤ì •)
                const koreanInput = koreanNameInput.querySelector('input');
                if (game.koreanName) {
                    koreanInput.value = game.koreanName;
                }
                
                selectedGames.push({
                    ...game,
                    sellPrice: defaultPrice,
                    customKoreanName: game.koreanName || ''
                });
            } else {
                gameCard.classList.remove('selected');
                const sellPriceInput = gameCard.querySelector('.sell-price-input');
                const koreanNameInput = gameCard.querySelector('.korean-name-input');
                sellPriceInput.classList.remove('show');
                koreanNameInput.classList.remove('show');
                
                selectedGames = selectedGames.filter(g => g.id !== game.id);
            }
            
            updateSelectionInfo();
        }
        
        function updateSellPrice(input, gameId) {
            const price = parseInt(input.value) || 0;
            const game = selectedGames.find(g => g.id === gameId);
            if (game) {
                game.sellPrice = price;
            }
        }
        
        function updateKoreanName(input, gameId) {
            const koreanName = input.value.trim();
            const game = selectedGames.find(g => g.id === gameId);
            if (game) {
                game.customKoreanName = koreanName;
            }
        }
        
        function updateSelectionInfo() {
            const count = selectedGames.length;
            document.getElementById('selectionInfo').textContent = `ì„ íƒëœ ê²Œì„: ${count}ê°œ`;
            
            const exportSection = document.getElementById('exportSection');
            if (count > 0) {
                exportSection.classList.add('show');
            } else {
                exportSection.classList.remove('show');
            }
        }
        
        function selectAllGames() {
            const checkboxes = document.querySelectorAll('.game-checkbox');
            checkboxes.forEach((checkbox, index) => {
                if (!checkbox.checked) {
                    checkbox.checked = true;
                    toggleGameSelection(checkbox, index);
                }
            });
        }
        
        function deselectAllGames() {
            const checkboxes = document.querySelectorAll('.game-checkbox');
            checkboxes.forEach((checkbox, index) => {
                if (checkbox.checked) {
                    checkbox.checked = false;
                    toggleGameSelection(checkbox, index);
                }
            });
        }
        
        async function exportToExcel() {
            if (selectedGames.length === 0) {
                alert('ë‚´ë³´ë‚¼ ê²Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const missingPrices = selectedGames.filter(game => !game.sellPrice || game.sellPrice <= 0);
            if (missingPrices.length > 0) {
                alert('ëª¨ë“  ì„ íƒëœ ê²Œì„ì˜ íŒë§¤ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            showProgress('Steam APIì—ì„œ ê²Œì„ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  ì—‘ì…€ íŒŒì¼ì„ ìƒì„±ì¤‘ì…ë‹ˆë‹¤...', 50);
            
            try {
                const response = await fetch(`${SERVER_URL}/api/export-excel`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        games: selectedGames,
                        user: 'wogho',
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error('ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨');
                }
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `game_store_${new Date().toISOString().slice(0, 10)}.xlsx`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                
                hideProgress();
                alert('âœ… ìŠ¤í† ì–´ìš© ì—‘ì…€ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\n\níŒŒì¼ êµ¬ì¡°: A1 í—¤ë” + 80ê°œ ì»¬ëŸ¼ ìŠ¤í† ì–´ ì–‘ì‹');
                
            } catch (error) {
                hideProgress();
                alert('âŒ ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ê´€ë¦¬ìš© ì—‘ì…€ ë‚´ë³´ë‚´ê¸° (A5 íŒë§¤ê°€ -500 ê³ ì • ë°˜ì˜)
        async function exportToExcelManagement() {
            if (selectedGames.length === 0) {
                alert('ë‚´ë³´ë‚¼ ê²Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // íŒë§¤ê°€ê°€ ì…ë ¥ë˜ì§€ ì•Šì€ ê²Œì„ í™•ì¸
            const missingPrices = selectedGames.filter(game => !game.sellPrice || game.sellPrice <= 0);
            if (missingPrices.length > 0) {
                alert('ëª¨ë“  ì„ íƒëœ ê²Œì„ì˜ íŒë§¤ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì‚¬ìš©ìì—ê²Œ -500ì› ì°¨ê° ì •ì±… ì•ˆë‚´
            if (!confirm('ê´€ë¦¬ìš© ì—‘ì…€ì—ì„œëŠ” A5 íŒë§¤ê°€ì—ì„œ ìë™ìœ¼ë¡œ 500ì›ì´ ì°¨ê°ë©ë‹ˆë‹¤.\n\nì˜ˆì‹œ: ì…ë ¥ê°’ 35,000ì› â†’ ì—‘ì…€ 34,500ì›\n\nê³„ì† ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            showProgress('ê´€ë¦¬ìš© ì—‘ì…€ íŒŒì¼ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤... (A5 íŒë§¤ê°€ -500ì› ì ìš©)', 50);
            
            try {
                const response = await fetch(`${SERVER_URL}/api/export-excel-management`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        games: selectedGames,
                        user: 'wogho',
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error('ê´€ë¦¬ìš© ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨');
                }
                
                // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `game_management_${new Date().toISOString().slice(0, 10)}.xlsx`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                
                hideProgress();
                alert('âœ… ê´€ë¦¬ìš© ì—‘ì…€ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\n\níŒŒì¼ êµ¬ì¡°:\nA1: ìƒí’ˆëª…\nA2: ë¹ˆì¹¸\nA3: CDKeys ë§í¬\nA4: 0\nA5: íŒë§¤ê°€ (ì…ë ¥ê°’ -500ì›) ğŸ’°\nA6: 0\nA7: CDKeys ê°€ê²©');
                
            } catch (error) {
                hideProgress();
                alert('âŒ ê´€ë¦¬ìš© ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        async function clearCache() {
            if (!confirm('ìºì‹œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const response = await fetch(`${SERVER_URL}/api/cache`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('ìºì‹œê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                alert('ìºì‹œ ì´ˆê¸°í™” ì‹¤íŒ¨');
            }
        }
        
        function showProgress(text, percent = 0) {
            const section = document.getElementById('progressSection');
            section.classList.add('active');
            document.getElementById('progressText').textContent = text;
            
            const fill = document.getElementById('progressFill');
            fill.style.width = `${percent}%`;
            fill.textContent = `${percent}%`;
        }
        
        function hideProgress() {
            document.getElementById('progressSection').classList.remove('active');
        }
        
        function showError(message) {
            const results = document.getElementById('results');
            results.innerHTML = `<div class="error-message">${message}</div>`;
        }
        
        function formatPrice(price) {
            if (price === null || price === undefined || isNaN(price)) {
                return 'â‚©0';
            }
            return `â‚©${price.toLocaleString('ko-KR')}`;
        }
        
        function parsePrice(priceString) {
            if (!priceString) return 0;
            
            if (priceString === 'ë¬´ë£Œ' || priceString.toLowerCase().includes('free')) return 0;
            
            if (priceString.includes('â‚©')) {
                return parseInt(priceString.replace(/[â‚©,\s]/g, ''));
            }
            
            if (priceString.includes('$')) {
                const dollars = parseFloat(priceString.replace(/[$,\s]/g, ''));
                return Math.round(dollars * 1320);
            }
            
            if (priceString.includes('â‚¬')) {
                const euros = parseFloat(priceString.replace(/[â‚¬,\s]/g, ''));
                return Math.round(euros * 1430);
            }
            
            if (priceString.includes('Â£')) {
                const pounds = parseFloat(priceString.replace(/[Â£,\s]/g, ''));
                return Math.round(pounds * 1670);
            }
            
            return 0;
        }
        
        function displaySingleResult(game) {
            document.getElementById('statsSection').style.display = 'grid';
            document.getElementById('totalGames').textContent = 1;
            document.getElementById('discountedGames').textContent = game.isProfit ? 1 : 0;
            document.getElementById('notFoundGames').textContent = 0;
            document.getElementById('avgSavings').textContent = formatPrice(game.savingsAmount);
            document.getElementById('maxSavings').textContent = formatPrice(game.savingsAmount);
            
            // allGames ë°°ì—´ êµ¬ì„± (ì—‘ì…€ ë‚´ë³´ë‚´ê¸°ë¥¼ ìœ„í•´)
            allGames = [{
                id: game.id,
                name: game.name,
                originalName: game.originalName,
                exactName: game.steamExactName || game.name,
                cdkeysPrice: game.cdkeysPriceKRW,
                steamFinalPrice: game.steamPriceKRW,
                steamOriginalPrice: game.steamPriceKRW,
                steamDiscount: game.steamDiscount || '',
                steamAppId: game.steamAppId,
                savings: game.savingsAmount,
                savingsPercent: game.savingsPercent,
                cdkeysUrl: game.url,
                source: game.steamSource,
                koreanName: '' // ì‚¬ìš©ìê°€ ì…ë ¥í•  ìˆ˜ ìˆë„ë¡
            }];
            
            const gameHTML = `
                <div class="game-card">
                    <input type="checkbox" class="game-checkbox" 
                           onchange="toggleGameSelection(this, 0)">
                    <div class="game-header">
                        <div class="game-title">
                            ${game.steamExactName || game.name}
                            ${game.steamSource ? `<span class="steam-source-badge">${game.steamSource}</span>` : ''}
                        </div>
                        <div class="${game.isProfit ? 'savings-badge' : 'not-found-badge'}">
                            ${game.savingsPercent}% ${game.isProfit ? 'ì ˆì•½' : 'ì†í•´'}
                        </div>
                    </div>
                    <div class="price-comparison">
                        <div class="price-box cdkeys-price">
                            <div class="price-label">CDKeys</div>
                            <div class="price-value">${game.cdkeysPrice}</div>
                        </div>
                        <div class="price-box steam-price">
                            <div class="price-label">Steam</div>
                            <div class="price-value">
                                ${game.steamPrice}
                                ${game.steamDiscount ? `<span class="discount-badge">${game.steamDiscount}</span>` : ''}
                            </div>
                            ${game.steamOriginalPrice !== game.steamPrice ? 
                                `<div class="original-price">${game.steamOriginalPrice}</div>` : ''}
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ì ˆì•½ì•¡</div>
                            <div style="font-size: 1.8em; font-weight: bold; color: ${game.isProfit ? '#4caf50' : '#dc3545'};">
                                ${formatPrice(game.savingsAmount)}
                            </div>
                        </div>
                    </div>
                    <div class="app-id-input">
                        <label>ğŸ”§ Steam App ID: ${game.steamAppId || 'N/A'}</label>
                    </div>
                    <div class="input-row">
                        <div class="sell-price-input">
                            <label>ğŸ’° íŒë§¤ê°€ ì„¤ì •:</label>
                            <input type="number" placeholder="íŒë§¤ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                                   onchange="updateSellPrice(this, '${game.id}')" 
                                   value="${game.sellPrice}"
                                   min="0" step="1000">
                        </div>
                        <div class="korean-name-input">
                            <label>ğŸ‡°ğŸ‡· í•œê¸€ëª… ì„¤ì • (ì„ íƒì‚¬í•­):</label>
                            <input type="text" placeholder="í•œê¸€ëª…ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”" 
                                   onchange="updateKoreanName(this, '${game.id}')"
                                   maxlength="50">
                        </div>
                    </div>
                    ${game.url ? `
                    <div class="action-buttons">
                        <a href="${game.url}" target="_blank" class="btn-link btn-cdkeys">
                            CDKeysì—ì„œ êµ¬ë§¤
                        </a>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('results').innerHTML = gameHTML;
        }
        
        function displayResults(data) {
            const { totalGames, discountedGames, notFoundGames, games } = data;
            
            document.getElementById('statsSection').style.display = 'grid';
            document.getElementById('totalGames').textContent = totalGames || 0;
            document.getElementById('discountedGames').textContent = discountedGames || 0;
            document.getElementById('notFoundGames').textContent = notFoundGames || 0;
            
            if (games && games.length > 0) {
                const avgSavings = Math.round(games.reduce((sum, g) => sum + (g.savings || 0), 0) / games.length);
                const maxSavings = Math.max(...games.map(g => g.savings || 0));
                
                document.getElementById('avgSavings').textContent = formatPrice(avgSavings);
                document.getElementById('maxSavings').textContent = formatPrice(maxSavings);
                
                const resultsHTML = games.map((game, index) => {
                    const cdkeysPrice = game.cdkeysPrice || 0;
                    const steamOriginalPrice = game.steamOriginalPrice || 0;
                    const steamFinalPrice = game.steamFinalPrice || steamOriginalPrice;
                    const savings = game.savings || 0;
                    
                    return `
                        <div class="game-card">
                            <input type="checkbox" class="game-checkbox" 
                                   onchange="toggleGameSelection(this, ${index})">
                            <div class="game-header">
                                <div class="game-title">
                                    ${game.exactName || game.name}
                                    ${game.source ? `<span class="steam-source-badge">${game.source}</span>` : ''}
                                </div>
                                <div class="savings-badge">${game.savingsPercent || 0}% ì ˆì•½</div>
                            </div>
                            <div class="price-comparison">
                                <div class="price-box cdkeys-price">
                                    <div class="price-label">CDKeys</div>
                                    <div class="price-value">${formatPrice(cdkeysPrice)}</div>
                                </div>
                                <div class="price-box steam-price">
                                    <div class="price-label">Steam</div>
                                    <div class="price-value">
                                        ${formatPrice(steamFinalPrice)}
                                        ${game.steamDiscount ? `<span class="discount-badge">${game.steamDiscount}</span>` : ''}
                                    </div>
                                    ${steamOriginalPrice !== steamFinalPrice ? 
                                        `<div class="original-price">${formatPrice(steamOriginalPrice)}</div>` : ''}
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ì ˆì•½ì•¡</div>
                                    <div style="font-size: 1.8em; font-weight: bold; color: #4caf50;">
                                        ${formatPrice(savings)}
                                    </div>
                                </div>
                            </div>
                            <div class="app-id-input">
                                <label>ğŸ”§ App ID ì§ì ‘ ì…ë ¥ (Steam ì •ë³´ ì¬ì¡°íšŒ):</label>
                                <div class="app-id-controls">
                                    <input type="number" placeholder="Steam App ID ì…ë ¥" 
                                           data-game-id="${game.id}" 
                                           value="${game.steamAppId || ''}"
                                           min="1">
                                    <button onclick="refreshSteamInfo('${game.id}')" class="btn-info">ğŸ”„ ì¡°íšŒ</button>
                                </div>
                            </div>
                            <div class="input-row">
                                <div class="sell-price-input">
                                    <label>ğŸ’° íŒë§¤ê°€ ì„¤ì •:</label>
                                    <input type="number" placeholder="íŒë§¤ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                                           onchange="updateSellPrice(this, '${game.id}')" 
                                           min="0" step="1000">
                                </div>
                                <div class="korean-name-input">
                                    <label>ğŸ‡°ğŸ‡· í•œê¸€ëª… ì„¤ì • (ì„ íƒì‚¬í•­):</label>
                                    <input type="text" placeholder="í•œê¸€ëª…ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”" 
                                           onchange="updateKoreanName(this, '${game.id}')"
                                           maxlength="50">
                                </div>
                            </div>
                            ${game.cdkeysUrl ? `
                            <div class="action-buttons">
                                <a href="${game.cdkeysUrl}" target="_blank" class="btn-link btn-cdkeys">
                                    CDKeysì—ì„œ êµ¬ë§¤
                                </a>
                            </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
                
                document.getElementById('results').innerHTML = resultsHTML;
            } else {
                document.getElementById('avgSavings').textContent = 'â‚©0';
                document.getElementById('maxSavings').textContent = 'â‚©0';
                document.getElementById('results').innerHTML = 
                    '<div class="error-message">ì¡°ê±´ì— ë§ëŠ” í• ì¸ ê²Œì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }
        
        function displayNotFoundGames(data) {
            const { notFound } = data;
            
            if (notFound && notFound.length > 0) {
                document.getElementById('notFoundSection').classList.add('show');
                document.getElementById('notFoundInfo').textContent = `ë¯¸ë°œê²¬ ê²Œì„: ${notFound.length}ê°œ`;
                
                const notFoundHTML = notFound.map((game, index) => {
                    return `
                        <div class="game-card not-found">
                            <div class="game-header">
                                <div class="game-title">${game.name}</div>
                                <div class="not-found-badge">Steam ì •ë³´ ì—†ìŒ</div>
                            </div>
                            <div class="price-comparison">
                                <div class="price-box cdkeys-price">
                                    <div class="price-label">CDKeys</div>
                                    <div class="price-value">${formatPrice(parsePrice(game.price))}</div>
                                </div>
                                <div class="price-box" style="background: #ffe6e6; border: 2px solid #dc3545;">
                                    <div class="price-label">Steam</div>
                                    <div class="price-value" style="color: #dc3545;">ì •ë³´ ì—†ìŒ</div>
                                    <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                                        ${game.reason || 'Steamì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŒ'}
                                    </div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">ìƒíƒœ</div>
                                    <div style="font-size: 1.2em; font-weight: bold; color: #dc3545;">
                                        ì¡°íšŒ ì‹¤íŒ¨
                                    </div>
                                </div>
                            </div>
                            <div class="app-id-input">
                                <label>ğŸ”§ App ID ì§ì ‘ ì…ë ¥ (Steam ì •ë³´ ì¡°íšŒ):</label>
                                <div class="app-id-controls">
                                    <input type="number" placeholder="Steam App ID ì…ë ¥" 
                                           data-game-id="${game.id}" 
                                           min="1">
                                    <button onclick="refreshSteamInfoFromNotFound('${game.id}')" class="btn-warning">ğŸ” ê²€ìƒ‰</button>
                                </div>
                            </div>
                            ${game.cdkeysUrl ? `
                            <div class="action-buttons">
                                <a href="${game.cdkeysUrl}" target="_blank" class="btn-link btn-cdkeys">
                                    CDKeysì—ì„œ êµ¬ë§¤
                                </a>
                            </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
                
                document.getElementById('notFoundResults').innerHTML = notFoundHTML;
            }
        }
        
        // ë¯¸ë°œê²¬ ê²Œì„ì—ì„œ App IDë¡œ ê²€ìƒ‰
        async function refreshSteamInfoFromNotFound(gameId) {
            const appIdInput = document.querySelector(`input[data-game-id="${gameId}"]`);
            const appId = appIdInput.value.trim();
            
            if (!appId) {
                alert('App IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!/^\d+$/.test(appId)) {
                alert('App IDëŠ” ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            const button = appIdInput.nextElementSibling;
            button.disabled = true;
            button.textContent = 'ê²€ìƒ‰ì¤‘...';
            
            try {
                // ë¯¸ë°œê²¬ ê²Œì„ ëª©ë¡ì—ì„œ í•´ë‹¹ ê²Œì„ ì°¾ê¸°
                const notFoundGame = notFoundGames.find(game => game.id === gameId);
                if (!notFoundGame) {
                    throw new Error('ê²Œì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const response = await fetch(`${SERVER_URL}/api/refresh-steam-info`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        gameId: gameId,
                        appId: appId,
                        allGames: [notFoundGame] // ì„ì‹œë¡œ ë°°ì—´ì— ë„£ì–´ì„œ ì „ì†¡
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // ë¯¸ë°œê²¬ ëª©ë¡ì—ì„œ ì œê±°í•˜ê³  ì„±ê³µ ëª©ë¡ì— ì¶”ê°€
                    notFoundGames = notFoundGames.filter(game => game.id !== gameId);
                    allGames.push(data.game);
                    
                    // í™”ë©´ ìƒˆë¡œê³ ì¹¨
                    displayResults({
                        totalGames: allGames.length + notFoundGames.length,
                        discountedGames: allGames.length,
                        notFoundGames: notFoundGames.length,
                        games: allGames
                    });
                    
                    displayNotFoundGames({
                        notFound: notFoundGames
                    });
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    document.getElementById('discountedGames').textContent = allGames.length;
                    document.getElementById('notFoundGames').textContent = notFoundGames.length;
                    
                    alert(`âœ… Steam ì •ë³´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì°¾ì•˜ìŠµë‹ˆë‹¤!\n\nê²Œì„ëª…: ${data.game.exactName}\nì ˆì•½ì•¡: ${formatPrice(data.game.savings)}\n\ní• ì¸ ê²Œì„ ëª©ë¡ìœ¼ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else {
                    throw new Error(data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                }
                
            } catch (error) {
                alert(`âŒ Steam ì •ë³´ ê²€ìƒ‰ ì‹¤íŒ¨: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = 'ğŸ” ê²€ìƒ‰';
            }
        }
        
        // ê°€ê²© íŒŒì‹± í•¨ìˆ˜ (í”„ë¡ íŠ¸ì—”ë“œìš©)
        function parsePrice(priceString) {
            if (!priceString) return 0;
            
            if (priceString.includes('â‚©')) {
                return parseInt(priceString.replace(/[â‚©,\s]/g, ''));
            }
            
            if (priceString.includes('$')) {
                const dollars = parseFloat(priceString.replace(/[$,\s]/g, ''));
                return Math.round(dollars * 1320);
            }
            
            return 0;
        }
    </script>
</body>
</html>